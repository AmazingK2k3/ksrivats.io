@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Crimson+Pro:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap');

@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  /* Light mode - Anthropic-inspired cream palette */
  --background: hsl(38, 100%, 97%);
  --foreground: hsl(332, 27%, 19%);
  --card:  hsl(38, 100%, 97%);
  --card-foreground: hsl(332, 27%, 19%);
  --popover: hsl(35, 17%, 99%);
  --popover-foreground: hsl(25, 5%, 20%);
  --primary: hsl(319, 51%, 25%);
  --primary-foreground: hsl(35, 17%, 97%);
  --secondary: hsl(35, 17%, 95%);
  --secondary-foreground:  hsl(332, 27%, 19%);
  --muted: hsl(35, 12%, 92%);
  --muted-foreground: hsl(25, 5%, 45%);
  --accent: hsl(314, 31%, 89%);
  --accent-foreground:  hsl(332, 27%, 19%);
  --destructive: hsl(0, 84%, 60%);
  --destructive-foreground: hsl(35, 17%, 97%);
  --border: hsl(35, 12%, 88%);
  --input: hsl(35, 12%, 88%);
  --ring: hsl(319, 51%, 25%);
  --radius: 0.75rem;
  
  /* Custom cream colors */
  --cream-50: hsl(35, 17%, 97%);
  --cream-100: hsl(35, 17%, 95%);
  --cream-200: hsl(35, 17%, 90%);
  --cream-300: hsl(28, 36%, 68%);
  --cream-400: hsl(28, 36%, 60%);
  --cream-500: hsl(28, 36%, 52%);
  --cream-600: hsl(28, 36%, 44%);
  
  /* Custom sage colors */
  --sage-50: hsl(120, 8%, 97%);
  --sage-100: hsl(120, 8%, 94%);
  --sage-200: hsl(120, 8%, 88%);
  --sage-300: hsl(120, 8%, 82%);
  --sage-400: hsl(120, 8%, 65%);
  --sage-500: hsl(120, 8%, 50%);
  --sage-600: hsl(120, 8%, 35%);
}

/* Clean background - no decorative elements */

.dark {
  /* Dark mode - Deep wine/burgundy palette */
  --background: hsl(324, 51%, 13%);
  --foreground: hsl(35, 17%, 95%);
  --card: hsl(322, 56%, 12%);
  --card-foreground: hsl(35, 17%, 95%);
  --popover: hsl(320, 45%, 16%);
  --popover-foreground: hsl(35, 17%, 95%);
  --primary: hsl(319, 51%, 45%);
  --primary-foreground: hsl(35, 17%, 95%);
  --secondary: hsl(320, 45%, 20%);
  --secondary-foreground: hsl(35, 17%, 95%);
  --muted: hsl(320, 45%, 22%);
  --muted-foreground: hsl(35, 17%, 70%);
  --accent: hsl(320, 45%, 22%);
  --accent-foreground: hsl(35, 17%, 95%);
  --destructive: hsl(0, 62%, 50%);
  --destructive-foreground: hsl(35, 17%, 95%);
  --border: hsl(320, 45%, 25%);
  --input: hsl(320, 45%, 25%);
  --ring: hsl(319, 51%, 45%);
  
  /* Custom wine colors */
  --wine-50: hsl(320, 45%, 95%);
  --wine-100: hsl(320, 45%, 90%);
  --wine-200: hsl(320, 45%, 80%);
  --wine-300: hsl(320, 45%, 70%);
  --wine-400: hsl(320, 45%, 60%);
  --wine-500: hsl(320, 45%, 50%);
  --wine-600: hsl(320, 45%, 40%);
  --wine-700: hsl(320, 45%, 35%);
  --wine-800: hsl(320, 45%, 25%);
  --wine-900: hsl(320, 45%, 18%);
}

@layer base {
  * {
    @apply border-border;
  }
  
  html {
    scroll-behavior: smooth;
  }
  
  body {
    @apply bg-background text-foreground;
    font-family: 'Crimson Pro', Georgia, serif;
    font-feature-settings: 'clig' off, 'liga' off;
    line-height: 1.6;
  }
  
  button {
    font-family: 'Inter', system-ui, sans-serif;
  }
  
  h1, h2, h3, h4, h5, h6 {
    font-family: 'Inter', system-ui, sans-serif;
    font-weight: 600;
    line-height: 1.2;
    color: #461031; /* Purple for light theme */
  }
  
  .dark h1, .dark h2, .dark h3, .dark h4, .dark h5, .dark h6 {
    color: #F9DBBB; /* Cream for dark theme */
  }
  
  code {
    font-family: 'JetBrains Mono', Monaco, monospace;
  }
}

@layer components {
  .gradient-text {
    color: #461031; /* Purple for light theme */
  }
  
  .dark .gradient-text {
    color: #F9DBBB; /* Cream for dark theme */
  }
  
  .glass {
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }
  
  .animate-float {
    animation: float 3s ease-in-out infinite;
  }
  
  @keyframes float {
    0%, 100% { transform: translateY(0px); }
    50% { transform: translateY(-10px); }
  }
  
  .animate-fade-in {
    animation: fadeIn 0.6s ease-in-out;
  }
  
  @keyframes fadeIn {
    0% { opacity: 0; transform: translateY(20px); }
    100% { opacity: 1; transform: translateY(0); }
  }
  
  .animate-slide-up {
    animation: slideUp 0.8s ease-out;
  }
  
  @keyframes slideUp {
    0% { opacity: 0; transform: translateY(40px); }
    100% { opacity: 1; transform: translateY(0); }
  }
}

/* Custom scrollbar */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: transparent;
}

::-webkit-scrollbar-thumb {
  background: var(--cream-300);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--cream-400);
}

.dark ::-webkit-scrollbar-thumb {
  background: var(--wine-700);
}

.dark ::-webkit-scrollbar-thumb:hover {
  background: var(--wine-600);
}

/* Smooth transitions */
* {
  transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
}

/* Prose styling for markdown content */
.prose {
  @apply max-w-none;
  color: hsl(var(--foreground));
}

.prose p {
  @apply mb-4;
  color: hsl(var(--foreground));
}

.prose h1, .prose h2, .prose h3, .prose h4, .prose h5, .prose h6 {
  @apply font-sans font-semibold mb-4 mt-8;
  color: #461031; /* Purple for light theme */
}

.dark .prose h1, .dark .prose h2, .dark .prose h3, .dark .prose h4, .dark .prose h5, .dark .prose h6 {
  color: #F9DBBB !important; /* Cream for dark theme */
}

.prose h1 {
  @apply text-4xl;
}

.prose h2 {
  @apply text-3xl;
}

.prose h3 {
  @apply text-2xl;
}

.prose blockquote {
  @apply border-l-4 border-primary pl-4 italic my-6;
  color: hsl(var(--muted-foreground));
}

.prose code {
  @apply bg-muted px-2 py-1 rounded text-sm font-mono;
  color: hsl(var(--foreground));
}

.prose pre {
  @apply bg-muted p-4 rounded-lg overflow-x-auto my-6;
}

.prose pre code {
  @apply bg-transparent p-0;
}

.prose ul, .prose ol {
  @apply mb-4 pl-6;
}

.prose li {
  @apply mb-2;
  color: hsl(var(--foreground));
}

.prose a {
  @apply text-primary hover:underline;
}

.prose img {
  @apply rounded-lg shadow-lg my-6 mx-auto;
  max-width: 100%;
  height: auto;
}

/* Image captions: ![alt](src) followed by *caption text* */
.prose img + em,
.prose p:has(> img) + p > em:only-child {
  @apply block text-center text-sm mt-2 not-italic;
  color: hsl(var(--muted-foreground));
}

.prose video {
  @apply rounded-lg shadow-lg my-6 mx-auto;
  max-width: 100%;
  height: auto;
}

/* Citation markers in prose */
.citation-ref {
  @apply text-primary font-semibold cursor-pointer;
  font-size: 0.85em;
  vertical-align: super;
  line-height: 0;
  padding: 0 2px;
  transition: color 0.2s ease, background-color 0.2s ease;
  border-radius: 2px;
}

.citation-ref:hover {
  color: hsl(var(--primary) / 0.8);
  text-decoration: underline;
  background-color: hsl(var(--accent));
}

/* Citation card */
.citation-card {
  @apply border rounded-lg shadow-md p-3;
  background: hsl(var(--card));
  border-color: hsl(var(--border));
  max-width: 220px;
  font-size: 0.8rem;
  overflow-wrap: break-word;
  word-break: break-word;
}

.citation-card-pinned {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  border-color: hsl(var(--primary));
}

.citation-card-enter {
  animation: fadeSlideIn 0.2s ease-out forwards;
}

@keyframes fadeSlideIn {
  from {
    opacity: 0;
    transform: translateX(10px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* Highlight animation when scrolling to a reference */
.citation-highlight {
  animation: refHighlight 2s ease-out;
  border-radius: 4px;
}

@keyframes refHighlight {
  0% { background-color: hsl(var(--primary) / 0.2); }
  100% { background-color: transparent; }
}

.prose strong {
  color: hsl(var(--foreground));
  font-weight: 600;
}

.prose em {
  color: hsl(var(--foreground));
}

/* Mobile-specific improvements */
@media (max-width: 640px) {
  /* Ensure proper spacing and alignment on mobile */
  .mobile-center {
    @apply text-center;
  }
  
  /* Better mobile button spacing */
  .mobile-button-spacing {
    @apply space-y-3;
  }
  
  /* Mobile-optimized text sizes */
  .mobile-text-responsive {
    @apply text-base leading-relaxed;
  }
  
  /* Prevent horizontal scroll */
  body {
    overflow-x: hidden;
  }
  
  /* Better mobile card padding */
  .mobile-card-padding {
    @apply px-3 py-4;
  }
  
  /* Ensure images don't overflow */
  img {
    max-width: 100%;
    height: auto;
  }
}

/* Improved mobile touch targets */
@media (max-width: 640px) {
  button, a, [role="button"] {
    min-height: 44px; /* iOS recommended touch target size */
    min-width: 44px;
  }
}

/* Better mobile typography scaling */
@media (max-width: 380px) {
  .gradient-text {
    @apply text-3xl;
  }
  
  h1 {
    @apply text-3xl;
  }
  
  h2 {
    @apply text-2xl;
  }
}

/* Loading Screen Animations */
@keyframes logo-entrance {
  0% {
    opacity: 0;
    transform: scale(0.3) translateY(50px) rotate(-15deg);
  }
  20% {
    opacity: 0.6;
    transform: scale(0.6) translateY(20px) rotate(-8deg);
  }
  60% {
    opacity: 0.9;
    transform: scale(1.15) translateY(-10px) rotate(3deg);
  }
  80% {
    opacity: 1;
    transform: scale(0.98) translateY(2px) rotate(-1deg);
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0) rotate(0deg);
  }
}

@keyframes logo-glow {
  0%, 100% {
    opacity: 0.1;
    transform: scale(0.8);
  }
  50% {
    opacity: 0.4;
    transform: scale(1.3);
  }
}

@keyframes page-entrance {
  0% {
    opacity: 0;
    transform: translateY(30px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-logo-entrance {
  animation: logo-entrance 2.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
}

.animate-logo-glow {
  animation: logo-glow 4s ease-in-out infinite;
}

.animate-page-entrance {
  animation: page-entrance 0.8s ease-out forwards;
}

/* ============================================================
   ENHANCED MARKDOWN RENDERING
   ============================================================ */

/* --- Code blocks with syntax highlighting --- */
.prose pre {
  position: relative;
  background: #0d1117 !important;
  border: 1px solid hsl(var(--border));
  border-radius: 0.5rem;
  padding: 1.25rem 1rem;
  overflow-x: auto;
  margin: 1.5rem 0;
}

.prose pre code {
  background: transparent !important;
  padding: 0 !important;
  font-size: 0.875rem;
  line-height: 1.7;
  font-family: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', monospace;
}

/* Copy button */
.copy-btn {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  padding: 0.25rem 0.65rem;
  font-size: 0.7rem;
  font-family: inherit;
  font-weight: 500;
  border-radius: 0.35rem;
  border: 1px solid rgba(255, 255, 255, 0.15);
  background: rgba(255, 255, 255, 0.08);
  color: rgba(255, 255, 255, 0.7);
  cursor: pointer;
  transition: background 0.15s, color 0.15s;
  z-index: 10;
}

.copy-btn:hover {
  background: rgba(255, 255, 255, 0.18);
  color: #fff;
}

/* --- Callout / alert boxes --- */
.callout {
  border-radius: 0.5rem;
  border-left-width: 4px;
  border-left-style: solid;
  padding: 0.875rem 1.1rem;
  margin: 1.5rem 0;
}

.callout-title {
  font-weight: 600;
  font-size: 0.875rem;
  margin-bottom: 0.35rem;
  display: flex;
  align-items: center;
  gap: 0.4rem;
}

.callout-body {
  font-size: 0.9rem;
  line-height: 1.6;
}

.callout-body > p:first-child { margin-top: 0; }
.callout-body > p:last-child  { margin-bottom: 0; }

.callout-body-unused {
  /* placeholder to avoid empty rule lint warning */
  color: inherit;
}

/* Note — blue */
.callout-note {
  background: hsl(214 100% 97%);
  border-color: hsl(214 80% 52%);
  color: hsl(214 60% 25%);
}
.dark .callout-note {
  background: hsl(214 50% 15%);
  border-color: hsl(214 70% 50%);
  color: hsl(214 40% 85%);
}

/* Tip — green */
.callout-tip {
  background: hsl(142 60% 96%);
  border-color: hsl(142 60% 40%);
  color: hsl(142 50% 20%);
}
.dark .callout-tip {
  background: hsl(142 40% 12%);
  border-color: hsl(142 55% 42%);
  color: hsl(142 35% 82%);
}

/* Important — purple */
.callout-important {
  background: hsl(270 60% 97%);
  border-color: hsl(270 60% 55%);
  color: hsl(270 50% 25%);
}
.dark .callout-important {
  background: hsl(270 40% 14%);
  border-color: hsl(270 55% 55%);
  color: hsl(270 40% 85%);
}

/* Warning — amber */
.callout-warning {
  background: hsl(45 100% 96%);
  border-color: hsl(38 90% 50%);
  color: hsl(38 70% 22%);
}
.dark .callout-warning {
  background: hsl(38 60% 12%);
  border-color: hsl(38 80% 52%);
  color: hsl(38 60% 85%);
}

/* Caution — red */
.callout-caution {
  background: hsl(0 80% 97%);
  border-color: hsl(0 72% 52%);
  color: hsl(0 55% 22%);
}
.dark .callout-caution {
  background: hsl(0 45% 14%);
  border-color: hsl(0 65% 52%);
  color: hsl(0 45% 85%);
}

/* Suppress default blockquote styling when it becomes a callout */
.prose .callout {
  font-style: normal;
  border-left-width: 4px;
}

/* --- Highlighted / marked text --- */
.prose mark {
  background: hsl(50 100% 75%);
  color: hsl(38 70% 15%);
  border-radius: 0.2em;
  padding: 0.05em 0.2em;
}
.dark .prose mark {
  background: hsl(45 85% 38%);
  color: hsl(45 80% 96%);
}

/* --- Tables --- */
.prose table {
  width: 100%;
  border-collapse: collapse;
  margin: 1.5rem 0;
  font-size: 0.9rem;
  overflow-x: auto;
  display: block;
}

.prose thead {
  background: hsl(var(--muted));
}

.prose th {
  padding: 0.6rem 0.9rem;
  text-align: left;
  font-weight: 600;
  border: 1px solid hsl(var(--border));
  color: hsl(var(--foreground));
}

.prose td {
  padding: 0.55rem 0.9rem;
  border: 1px solid hsl(var(--border));
  color: hsl(var(--foreground));
  vertical-align: top;
}

.prose tbody tr:nth-child(even) {
  background: hsl(var(--muted) / 0.4);
}

.prose tbody tr:hover {
  background: hsl(var(--accent) / 0.4);
}

/* --- Collapsible sections (<details> / <summary>) --- */
.prose details {
  border: 1px solid hsl(var(--border));
  border-radius: 0.5rem;
  margin: 1.25rem 0;
  overflow: hidden;
}

.prose summary {
  padding: 0.7rem 1rem;
  cursor: pointer;
  font-weight: 600;
  background: hsl(var(--muted) / 0.5);
  user-select: none;
  list-style: none;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  color: hsl(var(--foreground));
  transition: background 0.15s;
}

.prose summary::before {
  content: '▶';
  font-size: 0.7em;
  transition: transform 0.2s ease;
  flex-shrink: 0;
}

.prose details[open] > summary::before {
  transform: rotate(90deg);
}

.prose summary::-webkit-details-marker {
  display: none;
}

.prose summary:hover {
  background: hsl(var(--muted));
}

.prose details > *:not(summary) {
  padding: 0 1rem;
}

.prose details > *:not(summary):last-child {
  padding-bottom: 0.75rem;
}

/* --- Math blocks & inline --- */
.math-block {
  overflow-x: auto;
  text-align: center;
  margin: 1.5rem 0;
}

.math-inline {
  display: inline;
}

/* KaTeX overrides for theme compatibility */
.dark .katex {
  color: hsl(var(--foreground));
}
